"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),!function(e,r){for(var t in r)Object.defineProperty(e,t,{enumerable:!0,get:r[t]})}(exports,{PLATFORM:function(){return l},TEMPLATES_ROOT:function(){return c},del:function(){return x},exe:function(){return p},exec:function(){return a},execOptions:function(){return s},getCurrentDir:function(){return d},getParentDir:function(){return u},initApp:function(){return $},removeApp:function(){return f},tree:function(){return S},unzip:function(){return g},zip:function(){return y}});const e=require("child_process"),r=/*#__PURE__*/i(require("path")),t=require("./builtin.js"),n=require("./git.js"),o=/*#__PURE__*/i(require("fs"));function i(e){return e&&e.__esModule?e:{default:e}}const c=`${process.env.DEV_CONFIG_ROOT}/Templates`??"C:/JnJ-soft/Developments/Templates",l="win32"===process.platform?"win":"darwin"===process.platform?"mac":"linux"===process.platform?"linux":process.platform,s={encoding:"utf8",shell:"win32"===process.platform?"cmd.exe /d /s /c chcp 65001>nul &&":"/bin/sh"},a=r=>{let t=(0,e.execSync)(r,{encoding:"utf8"});return t?t.toString().trim():""},p=e=>{let r=[];return e.forEach(e=>r.push(a(e))),r},d=()=>"win"===l?(0,e.execSync)("cd",s).toString().trim().replace(/\\/g,"/"):(0,e.execSync)("pwd",s).toString().trim(),u=()=>"win"===l?r.default.dirname((0,e.execSync)("cd",s).toString().trim().replace(/\\/g,"/")):r.default.dirname((0,e.execSync)("pwd",s).toString().trim()),m=r=>{let o=(0,n.findGithubAccount)(r.userName??""),i=u(),a=d(),p="";p="win"===l?`xcopy "${c}\\ts-swc-npm" "${r.repoName}\\" /E /I /H /Y`:`cp -r ${c}/ts-swc-npm ${r.repoName}`,(0,e.execSync)(p,s),(0,t.substituteInFile)(`${r.repoName}/package.json`,{"{{name}}":r.repoName??"","{{author}}":`${o.fullName} <${o.email}>`,"{{description}}":r.description??""}),(0,t.substituteInFile)(`${r.repoName}/README.md`,{"{{name}}":r.repoName??"","{{project-name}}":r.repoName??"","{{author}}":`${o.fullName} <${o.email}>`,"{{github-id}}":r.userName??"","{{description}}":r.description||"","{{parent-dir}}":i,"{{current-dir}}":a}),(0,t.substituteInFile)(`${r.repoName}/docs/workflow.md`,{"{{name}}":r.repoName??"","{{project-name}}":r.repoName??"","{{github-id}}":r.userName??"","{{description}}":r.description||"","{{parent-dir}}":i,"{{current-dir}}":a}),console.log(p=`cd ${a}/${r.repoName} && npm install`),(0,e.execSync)(p,s),console.log(p=`cd ${a}/${r.repoName} && xgit -e makeRepo -u ${r.userName} -n ${r.repoName} -d "${r.description}"`),(0,e.execSync)(p,s)},f=r=>{(0,e.execSync)(`xgit -e deleteRemoteRepo -u ${r.userName} -n ${r.repoName}`,s),"win"===l?(0,e.execSync)(`rmdir /s /q ${r.repoName}`,s):(0,e.execSync)(`rm -rf ${r.repoName}`,s)},$=e=>{switch(e.template){case"node-simple":case"python-pipenv":break;case"ts-swc-npm":m(e)}},x=e=>{(0,t.deleteFilesInFolder)(e.repoName??"",e.excluded??"",!0)},y=r=>{if("win"===l)try{let t=`${r.repoName}_temp`;for(let n of((0,e.execSync)(`xcopy "${r.repoName}" "${t}\\" /E /I /H /Y`,s),r.excluded?r.excluded.split(","):["node_modules","package-lock.json","package.json"])){let r=`${t}/${n}`;try{n.includes("/")?(0,e.execSync)(`rmdir /s /q "${r}"`,s):(0,e.execSync)(`del /q "${r}"`,s)}catch(e){console.log(`Warning: Could not remove ${n}`)}}(0,e.execSync)(`powershell -Command "Compress-Archive -Path ${t}/* -DestinationPath ${r.repoName}.zip -Force"`,s),(0,e.execSync)(`rmdir /s /q "${t}"`,s)}catch(e){throw console.error("Error during zip operation:",e),e}else{let t=r.excluded?r.excluded.split(",").map(e=>`"${e}"`).join(" "):'"*/node_modules/*" ".git/*"';(0,e.execSync)(`zip -r ${r.repoName}.zip ${r.repoName} -x ${t}`,s)}},g=(n,i="__MACOSX/,node_modules/,.DS_Store,.git/")=>{let c=d(),l=[];for(let a of(0,t.findFiles)(n,"*.zip"))try{let n;let p=`${c}/_unzip/${r.default.parse(a).name}`;if(console.log(`## extractPath: ${p}`),(0,t.makeDir)(p),"win32"===process.platform)for(let t of(n=`powershell -command "Expand-Archive -Path '${a}' -DestinationPath '${p}' -Force"`,i.split(",").map(e=>e.trim()))){let n=r.default.join(p,t.replace("/",""));t.endsWith("/")?(0,e.execSync)(`if exist "${n}" rmdir /s /q "${n}"`,s):(0,e.execSync)(`if exist "${n}" del /q "${n}"`,s)}else{let e=i.split(",").map(e=>`"${e.trim()}"`).join(" ");n=`unzip -o "${a}" -d "${p}" -x ${e}`}(0,e.execSync)(n),console.log(`압축 해제 완료: ${a} -> ${p}`);let d=o.default.readdirSync(p);if(1===d.length){let t=r.default.join(p,d[0]);if(o.default.statSync(t).isDirectory()){let n=o.default.readdirSync(t);if(d[0]===r.default.parse(a).name){for(let o of n){let n=r.default.join(t,o),i=r.default.join(p,o);"win32"===process.platform?(0,e.execSync)(`move "${n}" "${i}"`,s):(0,e.execSync)(`mv "${n}" "${i}"`,s)}"win32"===process.platform?(0,e.execSync)(`rmdir /s /q "${t}"`,s):(0,e.execSync)(`rm -rf "${t}"`,s)}}}l.push(p)}catch(e){console.error(`'${a}' 압축 해제 중 오류 발생:`,e.message)}return(0,t.deleteFilesInFolder)(c,"__MACOSX/",!0),l.join(",")},S=r=>{{if("win"===l){let n=r.excluded?r.excluded.split(",").join("|"):"node_modules|dist|_backups|_drafts|types|docs";try{let r=`powershell -NoProfile -ExecutionPolicy Bypass -Command "$OutputEncoding = [Console]::OutputEncoding = [Text.Encoding]::UTF8; tree /F /A | Select-String -NotMatch '${n}'"`;console.log("Command: ",r);let o=(0,e.execSync)(r,{encoding:"utf8",stdio:"pipe"});return console.log("Result: ",o),o&&(0,t.saveFile)("tree.txt",o,{overwrite:!0,newFile:!1,encoding:"utf8"}),o||""}catch(e){return console.error("Error executing tree command:",e),""}}let n=r.excluded?`"${r.excluded.split(",").join("|")}"`:'"node_modules|dist|_backups|_drafts|types|docs"',o=`tree -I ${n} --dirsfirst -L 3`;try{console.log("Command: ",o);let r=(0,e.execSync)(o,{encoding:"utf8",stdio:"pipe"});return r&&(0,t.saveFile)("tree.txt",r,{overwrite:!0,newFile:!1}),r||""}catch(e){return console.error("Error executing tree command:",e),""}}};