{"version":3,"sources":["../src/builtin.ts"],"sourcesContent":["// & Import AREA\r\n// &---------------------------------------------------------------------------\r\n// ? Builtin Modules\r\nimport * as fs from 'fs';\r\nimport Path from 'path';\r\nimport type { FileOptions, JsonOptions } from './types.js';\r\n\r\n\r\n// & Functions AREA\r\n// &---------------------------------------------------------------------------\r\n// * File System\r\n/**\r\n * remove BOM(Byte Order Mark, `U+FEFF`)\r\n */\r\nconst removeBOM = (str: string) => {\r\n  return str\r\n    .replace(/^\\uFEFF/gm, '')\r\n    .replace(/^\\u00BB\\u00BF/gm, '')\r\n    .replace(/\\r\\n/g, '\\n');\r\n};\r\n\r\n/**\r\n * 폴더이름에 포함된 \"\\\\\" => \"/\"\r\n */\r\nconst slashedFolder = (folderName: string) => {\r\n  folderName = folderName.replace(/\\\\/g, '/');\r\n  return folderName.endsWith('/') ? folderName.slice(0, -1) : folderName;\r\n};\r\n\r\n/**\r\n * set Path(실행 경로 기준)\r\n */\r\nconst setPath = (path: string) => {\r\n  if (path.startsWith('.')) {\r\n    path = Path.join(process.cwd(), path);\r\n  }\r\n  return slashedFolder(path);\r\n};\r\n\r\n/**\r\n * 한글 조합형 -> 완성형\r\n */\r\nconst composeHangul = (str: string | Buffer | undefined): string => {\r\n  if (!str) return '';\r\n  return str.toString().normalize('NFKC');\r\n};\r\n\r\n/**\r\n * 파일/폴더명으로 사용할 수 없는 문자 제거\r\n */\r\nconst sanitizePath = (str: string) => {\r\n  if (!str) return '';\r\n  str = composeHangul(str);\r\n\r\n  // 윈도우에서 파일/폴더명으로 사용할 수 없는 문자 제거\r\n  const invalidChars = /[<>:\"/\\\\|?*\\x00-\\x1F]/g;\r\n  // 마침표(.)로 시작하거나 끝나는 경우 제거\r\n  const invalidDots = /(^\\.+|\\.+$)/g;\r\n  // 연속된 공백을 하나의 공백으로 변환\r\n  const multipleSpaces = /\\s+/g;\r\n\r\n  return str\r\n    .replace(invalidChars, '') // 사용할 수 없는 문자 제거\r\n    .replace(invalidDots, '') // 시작/끝 마침표 제거\r\n    .replace(multipleSpaces, ' ') // 연속된 공백을 하나로\r\n    .trim(); // 앞뒤 공백 제거\r\n};\r\n\r\n/**\r\n * 파일명으로 사용가능하도록 문자열 변경\r\n */\r\nconst sanitizeName = (name: string) => {\r\n  if (!name) return '';\r\n  name = composeHangul(name);\r\n  return name\r\n    .replace(/\\[/g, '(')\r\n    .replace(/\\]/g, ')')\r\n    .replace(/[^\\uAC00-\\uD7A3a-zA-Z0-9_\\(\\)\\<\\>,\\s]/g, '')\r\n    .replace(/\\s+/g, ' ')\r\n    .trim();\r\n}\r\n\r\n/**\r\n * Load data(string) from file with charset(encoding)\r\n */\r\nconst loadFile = (path: string, encoding: BufferEncoding = 'utf8') => {\r\n  try {\r\n    return removeBOM(fs.readFileSync(setPath(path), { encoding }));\r\n  } catch {\r\n    return '';\r\n  }\r\n};\r\n\r\n/**\r\n * Load data(json) from file with charset(encoding)\r\n */\r\nconst loadJson = (path: string, encoding: BufferEncoding = 'utf8') => {\r\n  try {\r\n    return JSON.parse(removeBOM(fs.readFileSync(setPath(path), { encoding })));\r\n  } catch {\r\n    return {};\r\n  }\r\n};\r\n\r\n/**\r\n * Save data to file with charset(encoding), create Folder if not exist\r\n * @remarks\r\n * if overwrite is false, append data to file\r\n */\r\nconst saveFile = (\r\n  path: string,\r\n  data: any = '',\r\n  {\r\n    encoding = 'utf-8',\r\n    overwrite = true,\r\n    newFile = true\r\n  }: FileOptions = {}\r\n) => {\r\n  path = setPath(path);\r\n\r\n  if (newFile && fs.existsSync(path)) {\r\n    const dir = Path.dirname(path);\r\n    const ext = Path.extname(path);\r\n    const baseName = Path.basename(path, ext);\r\n    let counter = 1;\r\n\r\n    while (fs.existsSync(path)) {\r\n      path = Path.join(dir, `${baseName}(${counter})${ext}`);\r\n      counter++;\r\n    }\r\n  }\r\n\r\n  fs.mkdirSync(Path.dirname(path), { recursive: true });\r\n  overwrite\r\n    ? fs.writeFileSync(path, data, encoding)\r\n    : fs.appendFileSync(path, data, encoding);\r\n};\r\n\r\n/**\r\n * Save object(dict) to file with charset(encoding), create Folder if not exist\r\n * @remarks\r\n * # TODO : add `append` func\r\n */\r\nconst saveJson = (\r\n  path: string,\r\n  data = {},\r\n  {\r\n    indent = 2,\r\n    overwrite = true,\r\n    newFile = false\r\n  }: JsonOptions = {}\r\n) => {\r\n  saveFile(\r\n    setPath(path),\r\n    JSON.stringify(data, null, indent),\r\n    { overwrite, newFile }\r\n  );\r\n};\r\n\r\n/**\r\n * make directory if path not exist\r\n */\r\nconst makeDir = (path: string) => {\r\n  fs.mkdirSync(setPath(path), { recursive: true });\r\n};\r\n\r\n/**\r\n * copy fies in srcDir to dstDir recursively\r\n */\r\nconst copyDir = (srcDir: string, dstDir: string, recursive = true) => {\r\n  fs.cpSync(setPath(srcDir), setPath(dstDir), { recursive });\r\n};\r\n\r\n\r\n/**\r\n * find All Files In Folder(Recursively) By Pattern\r\n * @param folder\r\n * @param  arrayOfFiles\r\n * @param pattern\r\n */\r\nconst findFiles = (\r\n  folder: string,\r\n  pattern: string | RegExp = '',\r\n  arrayOfFiles: string[] = []\r\n) => {\r\n  if (!fs.existsSync(folder)) return [];\r\n  const files = fs.readdirSync(folder);\r\n  arrayOfFiles = arrayOfFiles || [];\r\n\r\n  files.forEach(function (file) {\r\n    if (fs.statSync(folder + '/' + file).isDirectory()) {\r\n      arrayOfFiles = findFiles(folder + '/' + file, pattern, arrayOfFiles);\r\n    } else {\r\n      const regex = pattern instanceof RegExp\r\n        ? pattern\r\n        : new RegExp(pattern.replace(/\\*/g, '.*'));\r\n      if (regex.test(file)) {\r\n        arrayOfFiles.push(Path.join(folder, '/', file));\r\n      }\r\n    }\r\n  });\r\n\r\n  return arrayOfFiles;\r\n};\r\n\r\n// base_path의 하위 폴더 중에 이름에 pattern을 포함하는 폴더\r\nfunction findFolders(basePath: string, pattern: string | RegExp = ''): string[] {\r\n  const matchedFolders: string[] = [];\r\n\r\n  for (const entry of fs.readdirSync(basePath)) {\r\n    const fullPath = Path.join(basePath, entry);\r\n    const regex = pattern instanceof RegExp\r\n      ? pattern\r\n      : new RegExp(pattern.replace(/\\*/g, '.*'));\r\n\r\n    if (fs.statSync(fullPath).isDirectory() && regex.test(entry)) {\r\n      matchedFolders.push(slashedFolder(fullPath));\r\n    }\r\n  }\r\n  return matchedFolders;\r\n}\r\n\r\n/**\r\n * exists Folder(폴더 존재여부)\r\n */\r\nconst existsFolder = (folder: string) => fs.existsSync(folder);\r\n\r\n\r\n/**\r\n * exists Folder(폴더 존재여부)\r\n */\r\nconst existsFile = (file: string) => fs.existsSync(file);\r\n\r\n/**\r\n * exists Folder(폴더 존재여부)\r\n */\r\nconst exists = (path: string) => fs.existsSync(path);\r\n\r\n/**\r\n * moveFile\r\n */\r\nconst moveFile = (\r\n  srcFolderName: string,\r\n  dstFolderName: string,\r\n  srcFileName: string,\r\n  dstFileName: string\r\n) => {\r\n  srcFolderName = slashedFolder(srcFolderName);\r\n  dstFolderName = slashedFolder(dstFolderName);\r\n\r\n  fs.rename(\r\n    `${srcFolderName}/${srcFileName}`,\r\n    `${dstFolderName}/${dstFileName}`,\r\n    (err) => console.log(err)\r\n  );\r\n};\r\n\r\n/**\r\n * moveFiles\r\n */\r\nconst moveFiles = (\r\n  srcFolderName: string,\r\n  dstFolderName: string,\r\n  srcFileNames: string[],\r\n  dstFileNames: string[]\r\n) => {\r\n  srcFolderName = slashedFolder(srcFolderName);\r\n  dstFolderName = slashedFolder(dstFolderName);\r\n\r\n  !fs.existsSync(dstFolderName) &&\r\n    fs.mkdirSync(dstFolderName, { recursive: true });\r\n  for (let i = 0; i < srcFileNames.length; i++) {\r\n    const srcFileName = srcFileNames[i];\r\n    const dstFileName = dstFileNames[i];\r\n    fs.rename(\r\n      `${srcFolderName}/${srcFileName}`,\r\n      `${dstFolderName}/${dstFileName}`,\r\n      (err) => console.log(err)\r\n    );\r\n  }\r\n};\r\n\r\n/**\r\n * rename Files In Folder\r\n * @param folder\r\n * @param  filterCb\r\n * @param  mapCb\r\n */\r\nconst renameFilesInFolder = (\r\n  folder: string,\r\n  filterCb: Function,\r\n  mapCb: Function\r\n) => {\r\n  folder = `${process.env.DIR_ROOT}/${folder}`;\r\n  filterCb = (name: string) => name.endsWith('.ts');\r\n  mapCb = (name: string) => `${folder}/${name}`;\r\n  return fs\r\n    .readdirSync(folder)\r\n    .filter((name) => filterCb(name))\r\n    .map((name) => mapCb(name));\r\n};\r\n\r\n/**\r\n * substitute in file\r\n * @param filePath\r\n * @param replacements {k1: v1, k2: v2, ...} (\"search\" -> \"replace\")\r\n */\r\nconst substituteInFile = (filePath: string, replacements: Record<string, string>) => {\r\n  let content = loadFile(filePath);\r\n  for (const [key, value] of Object.entries(replacements)) {\r\n    content = content.replace(new RegExp(key, 'g'), value);\r\n  }\r\n  saveFile(filePath, content, { overwrite: true, newFile: false });\r\n}\r\n\r\n// & Export AREA\r\n// &---------------------------------------------------------------------------\r\nexport {\r\n  slashedFolder, //\r\n  composeHangul,\r\n  setPath, // 상대경로->절대경로(실행 폴더 기준) './dir1/dir2' =>\r\n  sanitizeName, // 파일명으로 사용가능하도록 문자열 변경\r\n  loadFile, //\r\n  loadJson, //\r\n  saveFile, //\r\n  saveJson, //\r\n  makeDir, //\r\n  copyDir, // 폴더 복사(recursive)\r\n  findFiles, // 파일 목록\r\n  findFolders, // 하위 folder 목록\r\n  existsFolder, // 폴더 존재여부\r\n  existsFile, // 파일 존재여부\r\n  exists, // 존재여부\r\n  moveFile,\r\n  moveFiles,\r\n  substituteInFile\r\n};\r\n"],"names":["fs","Path","removeBOM","str","replace","slashedFolder","folderName","endsWith","slice","setPath","path","startsWith","join","process","cwd","composeHangul","toString","normalize","sanitizePath","invalidChars","invalidDots","multipleSpaces","trim","sanitizeName","name","loadFile","encoding","readFileSync","loadJson","JSON","parse","saveFile","data","overwrite","newFile","existsSync","dir","dirname","ext","extname","baseName","basename","counter","mkdirSync","recursive","writeFileSync","appendFileSync","saveJson","indent","stringify","makeDir","copyDir","srcDir","dstDir","cpSync","findFiles","folder","pattern","arrayOfFiles","files","readdirSync","forEach","file","statSync","isDirectory","regex","RegExp","test","push","findFolders","basePath","matchedFolders","entry","fullPath","existsFolder","existsFile","exists","moveFile","srcFolderName","dstFolderName","srcFileName","dstFileName","rename","err","console","log","moveFiles","srcFileNames","dstFileNames","i","length","renameFilesInFolder","filterCb","mapCb","env","DIR_ROOT","filter","map","substituteInFile","filePath","replacements","content","key","value","Object","entries"],"mappings":"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"}