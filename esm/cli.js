import{execSync as e}from"child_process";import p from"path";import{substituteInFile as o}from"./builtin";import{findGithubAccount as r}from"./git";let i=`${process.env.DEV_CONFIG_ROOT}/Templates`??"C:/JnJ-soft/Developments/Templates",t="win32"===process.platform?"win":"darwin"===process.platform?"mac":"linux"===process.platform?"linux":process.platform,m=p=>e(p,{encoding:"utf8"}).toString().trim(),a=e=>{let p=[];return e.forEach(e=>p.push(m(e))),p},s={encoding:"utf8",shell:"win32"===process.platform?"cmd.exe":"/bin/sh"},n=()=>p.dirname(e("pwd",s).toString().trim()),l=p=>{let m=r(p.userName??""),a=n();"win"===t?console.log("win"):(e(`cp -r ${i}/ts-swc-npm ${p.repoName}`,s),o(`${p.repoName}/package.json`,{"{{name}}":p.repoName??"","{{author}}":`${m.fullName} <${m.email}>`,"{{description}}":p.description??""}),o(`${p.repoName}/README.md`,{"{{name}}":p.repoName??"","{{author}}":`${m.fullName} <${m.email}>`,"{{github-id}}":p.userName??"","{{description}}":p.description||"","{{parent-dir}}":a}),e(`cd ${p.repoName} && npm install`,s),e(`github -e pushRepo -u ${p.userName} -n ${p.repoName} -d "${p.description}"`,s))},c=p=>{e(`github -e deleteRepo -u ${p.userName} -n ${p.repoName}`,s),e(`rm -rf ${p.repoName}`,s)},d=e=>{switch(e.template){case"node-simple":case"python-pipenv":break;case"ts-swc-npm":l(e)}},u=p=>{if("win"===t){let o=p.excluded?p.excluded.split(",").map(e=>`"${e}"`).join(","):'"*/node_modules/*",".git/*"';e(`powershell -Command "Compress-Archive -Path ${p.repoName} -DestinationPath ${p.repoName}.zip -Exclude ${o}"`,s)}else{let o=p.excluded?p.excluded.split(",").map(e=>`"${e}"`).join(" "):'"*/node_modules/*" ".git/*"';e(`zip -r ${p.repoName}.zip ${p.repoName} -x ${o}`,s)}};export{i as TEMPLATES_ROOT,t as PLATFORM,m as exec,a as exe,s as execOptions,n as getParentDir,d as initApp,c as removeApp,u as zip};