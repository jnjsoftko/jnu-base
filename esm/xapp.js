#!/usr/bin/env node
import e from"yargs";import{execSync as o}from"child_process";import i from"path";import{substituteInFile as t}from"./builtin";import{findGithubAccount as a}from"./github";let s=`${process.env.DEV_CONFIG_ROOT}/Templates`??"C:/JnJ-soft/Developments/Templates",n="win32"===process.platform?"win":"darwin"===process.platform?"mac":"linux"===process.platform?"linux":process.platform,p=e.usage("Usage: -e <command> -u <userName> -t <template> -n <repoName> -d <description> -g").option("e",{alias:"exec",describe:"Execute Command",type:"string",demandOption:!0}).option("u",{alias:"userName",default:"mooninlearn",describe:"Name of User",type:"string",demandOption:!0}).option("t",{alias:"template",default:"node",describe:"developemnt template(language)",type:"string"}).option("n",{alias:"repoName",describe:"NameOfRepository",type:"string",demandOption:!0}).option("d",{alias:"description",describe:"Description For Repository",type:"string"}).option("g",{alias:"github",default:!0,describe:"Use Github Repository",type:"boolean"}).parseSync(),r={exec:p.e,userName:p.u,template:p.t,repoName:p.n,description:p.d,github:p.g},m={encoding:"utf8",shell:"win32"===process.platform?"cmd.exe":"/bin/sh"},l=a(r.userName);if("init"===r.exec)switch(r.template){case"node-simple":case"python-pipenv":break;case"ts-swc-npm":(e=>{if("win"===n)console.log("win");else{o(`cp -r ${s}/ts-swc-npm ${r.repoName}`,m);let a=o("pwd",m).toString().trim(),n=i.dirname(a);t(`${r.repoName}/package.json`,{"{{name}}":r.repoName,"{{author}}":`${e.fullName} <${e.email}>`,"{{description}}":r.description||""}),t(`${r.repoName}/README.md`,{"{{name}}":r.repoName,"{{author}}":`${e.fullName} <${e.email}>`,"{{github-id}}":e.userName,"{{description}}":r.description||"","{{parent-dir}}":n}),o(`cd ${r.repoName} && npm install`,m)}})(l)}else console.log("Invalid command");